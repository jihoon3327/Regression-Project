# 제주렌트카 가격예측

![image-2.png](attachment:image-2.png)

### 주제 선정 이유
- 코로나 이슈 떄문에 제주도 렌트카 가격이 급증하고있다.
- 올 여름 여행을 위해 렌트카 가격을 미리 예측하여 돈을 미리 마련하고싶다.
![image.png](attachment:image.png)
![image-2.png](attachment:image-2.png)

### 데이터 수집
- 데이터 수집 사이트 : 제주패스랜트카
- 수집기간 : 6월~10월
- 수집방법 : 크롤링(selenium, bs4)

## 최초 데이터 변수 설명
### 독립변수(17개)  / 주요 독립변수 : "차량가격"
- 모델명 | 세그먼트 | 수용인원 | 연료타입 | 제공업체 | 랜트가능 최소 연령 |
- 보험종류 | 리뷰수 | 누적예약수 | 별점 | 일자 | 요일 | 취급렌트카수 | 연식 |
- 옵션종류 | 월 | 차량가격


### 종속변수
- 하루 렌트 가격

## 1개의 row 데이터 도식화
![image.png](attachment:image.png)
![image-2.png](attachment:image-2.png)

### 전처리 과정에서 생긴 독립변수들
#### 추가 독립변수 1 : "평일/휴일"
##### code
![image.png](attachment:image.png)
- 평일과 휴일을 나눈 기준
    - 월,화,수,목,일 : 평일
    - 금,토 & 공휴일 & 공휴일과 주말 사이의 평일 : 휴일
    






#### 추가 독립변수 2 : "성수기/비성수기"
##### 월별 가격 변동 그래프


![image-2.png](attachment:image-2.png)

- 7월 중순 ~ 8월 중순까지 성수기로 보았다.
- 차종마다 다르지만 일반적으로 이 기간에 가격이 비쌈
- 7월 15일부터 35일간 성수기로 정했다.

#### 추가 독립변수 3 : "옵션개수"
![image.png](attachment:image.png)
- 옵션의 유무로 1,0 으로 표현을 했지만 독립변수가 너무 많아진다.
- 해당 변수들을 다 지우고 "옵션개수" 변수를 추가해서 대체한다.

#### 수정 독립변수 4 : "연식"
- 크롤링데이터를 직접 가져오다보니 연식컬럼이 "2019~20연식" 이런식으로 저장되었다.
- Regression을 위해 수치형 데이터로 변경했다 : "2019~20연식" -> "2019"


```python
#모듈 추가
import pandas as pd
print("pandas version: ", pd.__version__)
pd.set_option('display.max_row', 1000)
pd.set_option('display.max_columns', 1000)
import openpyxl
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib import rc
import re
import statsmodels.api as sm
from statsmodels.sandbox.regression.predstd import wls_prediction_std
import warnings
import rise
warnings.filterwarnings(action='ignore')


rc('font', family='AppleGothic')

plt.rcParams['axes.unicode_minus'] = False
```

    pandas version:  1.2.4



```python
#데이터 읽기
jejurent_df = pd.read_excel("./jeju_Rev5.xlsx")

#평일/휴일 컬럼 추가
# 추가 이유 : 평일과 휴일(주말, 공휴일)에 따라 렌트카의 가격프리미엄이 붙는다.
jejurent_df["평일/휴일"] = "평일"


October_holidays = ["2021-10-02", "2021-10-01", "2021-10-09", "2021-10-08", "2021-10-15", "2021-10-16", "2021-10-22", "2021-10-23", "2021-10-29", "2021-10-30"]
june_holidays = ['2021-06-04','2021-06-05','2021-06-11','2021-06-12','2021-06-18','2021-06-19','2021-06-25','2021-06-26']
july_holidays = ['2021-07-02','2021-07-03','2021-07-09','2021-07-10','2021-07-16','2021-07-17','2021-07-23','2021-07-24','2021-07-30','2021-07-31']
august_holidays = ['2021-08-06','2021-08-07','2021-08-13','2021-08-14','2021-08-20','2021-08-21','2021-08-27','2021-08-28']
september_holidays = ['2021-09-03','2021-09-04','2021-09-10','2021-09-11','2021-09-17','2021-09-18','2021-09-19','2021-09-20','2021-09-21','2021-09-22','2021-09-23','2021-09-24','2021-09-25']

holidays =  june_holidays + july_holidays + august_holidays + september_holidays + October_holidays

for holiday in holidays:
    jejurent_df.loc[jejurent_df["Date"] == holiday, '평일/휴일'] = "휴일"
    

    
    
# 성수기 라벨링(07-15~08-18) 

import datetime
import time

vac_season = []
times = datetime.date(2021, 7, 15)
for i in range(35):
    vac_season.append(times.strftime('%Y-%m-%d'))
    times += datetime.timedelta(days=1)
    
jejurent_df["성수기/비성수기"] = "비성수기"

for day in vac_season:
    jejurent_df.loc[jejurent_df["Date"] == day, '성수기/비성수기'] = "성수기"

    


    
# 옵션 카운트컬럼 적용 및 옵션 컬럼 삭제
for i in range(15,29):
    jejurent_df[jejurent_df.columns[14]] += jejurent_df[jejurent_df.columns[i]]
jejurent_df.drop(columns=jejurent_df.columns[15:29], axis=1, inplace=True)
jejurent_df.rename(columns={"에어백":"옵션개수"}, inplace=True)    
    
    
    

#연식 컬럼 수정 (2020~21 -> 2020)
car_age_ls = []
for car_age in list(jejurent_df["연식"]):
    car_age_ls.append(car_age[0:4])


jejurent_df["연식"] = car_age_ls
```

## jejurent_df 데이터 결측치 확인
![image.png](attachment:image.png)

## EDA

#### 히트맵



![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.16.43-2.png](attachment:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.16.43-2.png)

- 렌트가격과 양의 상관관계가 높은 것은 차의 가격이었다.
- 음의 상관관계가 가장 높은 것은 취급업체수

#### 차량 가격대별 렌트가격

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-20%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%2012.02.06.png](attachment:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-20%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%2012.02.06.png)

- 차의 가격과 렌트 가격은 정비례한다

### 성수기 7/8월 성수기에는 렌트가격이 높게 형성된다.

![image.png](attachment:image.png)

### 성수기 비성수기 가격 비교
### 성수기에는 비성수기보다 가격이 높게 형성된다.
### 평일과 휴일에 가격 차이는 크지 않지만, 휴일이 약간 더 비쌈.
![image.png](attachment:image.png)

### 요일별 가격 -  요일별로 가격에 큰 차이는 보이지 않는다.
![image.png](attachment:image.png)

### 차종 별 가격 분포

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.34.03.png](attachment:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.34.03.png)


![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-20%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%2012.09.34.png](attachment:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-20%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%2012.09.34.png)

- 소형,중형,전기차는 대부분 20만원대 이내에 분포
- 승합차, 고급차, 수입차는 10-60만원대 이상까지 넓게 분포 

#### 부가옵션의 갯수와 가격의 상관관계

1. 부가옵션갯수가 많은 차는 고급차 또는 수입차

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.36.03.png](attachment:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.36.03.png)


### 옵션갯수와 가격  boxplot - 옵션갯수와 렌트가격은 전반적으로 정비례
![image.png](attachment:image.png)

### 연식은 오래될수록 렌트가격이 낮아진다.
![image.png](attachment:image.png)

#### 렌트가능 나이와 가격

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.59.27.png](attachment:%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-05-19%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2011.59.27.png)

## 모델적용

## 모델 적용하기!
### Dataframe
![image-2.png](attachment:image-2.png)
### 그 전에! 모델링 적용하기위해 이.뇨.석들을 수치형데이터로 처리해야한다.
![image.png](attachment:image.png)

### 모든 범주형 데이터를 더미변수화 시켜보자

### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
##### dataframe
![image.png](attachment:image.png)
##### 컬럼이 180개..
![image-2.png](attachment:image-2.png)

### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
###  OLS Summary

#### 결과 
![image-3.png](attachment:image-3.png)
- R-squared : 0.933 -> 컬럼수가 많아서 높아진걸로 보인다.


### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
###  OLS summary
![image.png](attachment:image.png)
- Condition No : 1.92*10^16 --> 해당 수치가 높을수록 과적합일 확률이 높다.

### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
### linear regression 적용

#### 결과 
![image-2.png](attachment:image-2.png)
- train 과 test의 RMSE값이 비슷한걸로 보아 과적합은 아닌걸로 판단된다.
![image.png](attachment:image.png)
- 가장 싼 차를 하루 빌리는데 평균 8만원이라면 2만6천원 오차는 조금 커보인다..
![image-3.png](attachment:image-3.png)
- 평균적으로 하루 빌리는데 가장 비싼차는 A5 카브리올레..1일 50만원이다..;;
- 50만원에 오차가 2만5천원정도면 괜찮아보인다.
- A5 카브리올레는 어떤 차길래 하루에 50만원이나 할까?

#### 역시 오픈카..
![image.png](attachment:image.png)

### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
### CrossValidation : 과적합여부를 CrossValidation으로 확인한다.

- train 데이터를 5등분하여 CrossValidation한다.
- 5등분한 데이터들의 cv_rmse값은 다음과 같다.
![image-3.png](attachment:image-3.png)
- 5개의 RMSE값의 평균은 다음과 같다.
![image-2.png](attachment:image-2.png)

### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
### RandomForestRegressor 모델 적용한 실제값과 예측값의 산점도를 그려보자

![image-2.png](attachment:image-2.png)
- 이상치들을 뽑아봤다.

![image.png](attachment:image.png)
- 거의 수입차이거나 국내 고급브랜드의 차종이다.

### 전처리 방법 1 : 모든 범주형 데이터 더미변수화 
### randomforest regression 모델을 적용

![image.png](attachment:image.png)
-> RMSE가 11000원으로 떨어졌다. 확실히 좋은 성능을 보여준다.

#### linear regression 모델보다 좀 더 잘 맞아 보인다.
![image.png](attachment:image.png)

## 결론

### 범주형 데이터 처리방법 : 더미변수화
#### 문제점
- 변수가 너무 많다.(180개)
- 과적합의 문제가 있을 수 있다.
- 변수가 많아 R-squared값이 자연스럽게 높아졌다.

#### 해결방안
- "Car_Name" 과 "EnterP" 컬럼을 더미변수화 말고 다른 방법을 적용하여 수치형데이터로 바꿔보자
- 앞으로 모델 적용은 Randomforest regression 모델만 사용한다.

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩

#### 라벨인코딩 컬럼 선정 
- 더미변수화를 했을 때 변수의 수가 급격히 늘어나는 컬럼은 "Car_name", "EnterP" 이다.
#### 라벨 인코딩
- 'Car_name', 'EnterP'
#### 더미 변수화
- 'Fuel_type','InsuranceType', '평일/휴일','성수기/비성수기','요일', 'Car_type'

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
### DataFrame
#### 컬럼 수가 확실히 줄었다.(180 -> 42)


```python
jejurent_df_lr_label
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RV/SUV</th>
      <th>경형</th>
      <th>고급</th>
      <th>소형</th>
      <th>수입</th>
      <th>승합</th>
      <th>전기</th>
      <th>준대형</th>
      <th>준중형</th>
      <th>중형</th>
      <th>금</th>
      <th>목</th>
      <th>수</th>
      <th>월</th>
      <th>일</th>
      <th>토</th>
      <th>화</th>
      <th>비성수기</th>
      <th>성수기</th>
      <th>평일</th>
      <th>휴일</th>
      <th>부분무제한</th>
      <th>슈퍼무제한</th>
      <th>완전자차</th>
      <th>LPG</th>
      <th>경유</th>
      <th>전기차</th>
      <th>하이브리드</th>
      <th>휘발유</th>
      <th>Capacity</th>
      <th>Age</th>
      <th>Review</th>
      <th>Resevation</th>
      <th>Star</th>
      <th>rentcar_company_count</th>
      <th>연식</th>
      <th>옵션개수</th>
      <th>Month</th>
      <th>Car_price</th>
      <th>Price</th>
      <th>EnterP_le</th>
      <th>Car_name_le</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>26</td>
      <td>0</td>
      <td>7</td>
      <td>0.0</td>
      <td>1</td>
      <td>2019</td>
      <td>13</td>
      <td>6</td>
      <td>85000000</td>
      <td>279600</td>
      <td>14</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>26</td>
      <td>2</td>
      <td>20</td>
      <td>3.1</td>
      <td>1</td>
      <td>2019</td>
      <td>9</td>
      <td>6</td>
      <td>80300000</td>
      <td>472000</td>
      <td>16</td>
      <td>43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
      <td>26</td>
      <td>0</td>
      <td>7</td>
      <td>0.0</td>
      <td>2</td>
      <td>2019</td>
      <td>10</td>
      <td>6</td>
      <td>79070000</td>
      <td>320500</td>
      <td>20</td>
      <td>78</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>26</td>
      <td>1</td>
      <td>27</td>
      <td>5.0</td>
      <td>3</td>
      <td>2020</td>
      <td>9</td>
      <td>6</td>
      <td>76500000</td>
      <td>378900</td>
      <td>22</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>26</td>
      <td>1</td>
      <td>17</td>
      <td>4.3</td>
      <td>1</td>
      <td>2020</td>
      <td>11</td>
      <td>6</td>
      <td>74790000</td>
      <td>378000</td>
      <td>31</td>
      <td>93</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>21144</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>26</td>
      <td>8</td>
      <td>233</td>
      <td>3.7</td>
      <td>1</td>
      <td>2020</td>
      <td>9</td>
      <td>10</td>
      <td>54790000</td>
      <td>446100</td>
      <td>30</td>
      <td>92</td>
    </tr>
    <tr>
      <th>21145</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
      <td>26</td>
      <td>0</td>
      <td>9</td>
      <td>0.0</td>
      <td>1</td>
      <td>2021</td>
      <td>13</td>
      <td>10</td>
      <td>59490000</td>
      <td>446100</td>
      <td>30</td>
      <td>46</td>
    </tr>
    <tr>
      <th>21146</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>26</td>
      <td>3</td>
      <td>24</td>
      <td>4.8</td>
      <td>1</td>
      <td>2020</td>
      <td>11</td>
      <td>10</td>
      <td>76500000</td>
      <td>531000</td>
      <td>30</td>
      <td>3</td>
    </tr>
    <tr>
      <th>21147</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>26</td>
      <td>1</td>
      <td>5</td>
      <td>4.6</td>
      <td>1</td>
      <td>2021</td>
      <td>9</td>
      <td>10</td>
      <td>66400000</td>
      <td>531000</td>
      <td>30</td>
      <td>8</td>
    </tr>
    <tr>
      <th>21148</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>26</td>
      <td>0</td>
      <td>1</td>
      <td>0.0</td>
      <td>1</td>
      <td>2021</td>
      <td>12</td>
      <td>10</td>
      <td>75660000</td>
      <td>531000</td>
      <td>30</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>21149 rows × 42 columns</p>
</div>



### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
#### OLS summary

#### 결과 
![image-4.png](attachment:image-4.png)
- R-squared : 0.788

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
#### OLS summary

#### 결과 
![image.png](attachment:image.png)




- Condition no : 1.92x10^16 -> 1.09x10^16  

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
### LinearRegression RMSE
![image.png](attachment:image.png)
- 더미변수화 LinearRegression RMSE 보다 1만원이 올라갔다.
- LinearRegression 모델을 적용할땐 "더미변수화"가 좋은 결과를 보여준다.

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
### RandomForest + CrossValidation : 과적합여부를 CrossValidation으로 확인한다.

- train 데이터를 5등분하여 CrossValidation한다.
- 5등분한 데이터들의 cv_rmse값은 다음과 같다.
![image.png](attachment:image.png)
- 5개의 RMSE값의 평균은 다음과 같다.
![image-2.png](attachment:image-2.png)
--> 더미변수화의 결과보다 400원 떨어졌다.(과적합이 덜 됐을 확률이 높아졌다.)

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
### RandomForestRegressor 모델 적용
![image.png](attachment:image.png)
- RMSE가 11500원으로 전 데이터보다 100원 내려갔다.

### 전처리 방법 2 : 모든 범주형 데이터 더미변수화 + 라벨 인코딩
### RandomForestRegressor 모델 적용
![image.png](attachment:image.png)
- 더미변수화 + RandomForestRegression 과 별반 차이는 없어 보인다.

## 결론

### 범주형 데이터 처리방법 : 라벨 인코딩
#### 문제점
- 자동차이름이나 렌트카이름 같은 컬럼을 단순히 0,1,2,3 와 같이 라벨을 매긴다면 렌트가격과 상관없는 순서가 생긴다.
![image.png](attachment:image.png)


#### 해결방안
- "Car_Name" 과 "EnterP" 컬럼을 의미있는 데이터로 변환하여 적용해보자.

## 전처리 방법 3 : 카테고리 임베딩 + 더미변수화

### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화

#### 카테고리 임베딩 컬럼 선정 
- "Car_name", "EnterP"
#### 카테고리 임베딩
- 'Car_name' : Car_price로 대체하고 Car_price 컬럼을 drop 한다.
- 'EnterP' : 랜터카 회사가 받은 별점의 평균을 'EnterP'로 대체한다.
#### 더미 변수화
- 'Car_type','요일','Fuel_type','InsuranceType', '평일/휴일','성수기/비성수기'

## 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
### DataFrame
- 컬럼 수는 변함없다.(42 -> 42)


```python
jejurent_df_lr_ca
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>비성수기</th>
      <th>성수기</th>
      <th>평일</th>
      <th>휴일</th>
      <th>부분무제한</th>
      <th>슈퍼무제한</th>
      <th>완전자차</th>
      <th>LPG</th>
      <th>경유</th>
      <th>전기차</th>
      <th>하이브리드</th>
      <th>휘발유</th>
      <th>금</th>
      <th>목</th>
      <th>수</th>
      <th>월</th>
      <th>일</th>
      <th>토</th>
      <th>화</th>
      <th>RV/SUV</th>
      <th>경형</th>
      <th>고급</th>
      <th>소형</th>
      <th>수입</th>
      <th>승합</th>
      <th>전기</th>
      <th>준대형</th>
      <th>준중형</th>
      <th>중형</th>
      <th>Car_name</th>
      <th>Capacity</th>
      <th>EnterP</th>
      <th>Age</th>
      <th>Review</th>
      <th>Resevation</th>
      <th>Star</th>
      <th>Date</th>
      <th>rentcar_company_count</th>
      <th>연식</th>
      <th>옵션개수</th>
      <th>Month</th>
      <th>Car_price</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>BMW 530D(경)</td>
      <td>5</td>
      <td>1.761446</td>
      <td>26</td>
      <td>0</td>
      <td>7</td>
      <td>0.0</td>
      <td>2021-06-01</td>
      <td>1</td>
      <td>2019</td>
      <td>13</td>
      <td>6</td>
      <td>85000000</td>
      <td>279600</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>벤츠 E220D 카브리올레(경)</td>
      <td>5</td>
      <td>2.044337</td>
      <td>26</td>
      <td>2</td>
      <td>20</td>
      <td>3.1</td>
      <td>2021-06-01</td>
      <td>1</td>
      <td>2019</td>
      <td>9</td>
      <td>6</td>
      <td>80300000</td>
      <td>472000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>제네시스 G90(휘)</td>
      <td>5</td>
      <td>2.678451</td>
      <td>26</td>
      <td>0</td>
      <td>7</td>
      <td>0.0</td>
      <td>2021-06-01</td>
      <td>2</td>
      <td>2019</td>
      <td>10</td>
      <td>6</td>
      <td>79070000</td>
      <td>320500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>BMW 430i 컨버터블(휘)</td>
      <td>4</td>
      <td>3.715954</td>
      <td>26</td>
      <td>1</td>
      <td>27</td>
      <td>5.0</td>
      <td>2021-06-01</td>
      <td>3</td>
      <td>2020</td>
      <td>9</td>
      <td>6</td>
      <td>76500000</td>
      <td>378900</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>테슬라모델3 퍼포먼스 EV(전기/충전비유료)</td>
      <td>5</td>
      <td>3.181405</td>
      <td>26</td>
      <td>1</td>
      <td>17</td>
      <td>4.3</td>
      <td>2021-06-01</td>
      <td>1</td>
      <td>2020</td>
      <td>11</td>
      <td>6</td>
      <td>74790000</td>
      <td>378000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>21144</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>테슬라모델3 EV(전기/충전비유료)</td>
      <td>5</td>
      <td>3.257546</td>
      <td>26</td>
      <td>8</td>
      <td>233</td>
      <td>3.7</td>
      <td>2021-10-30</td>
      <td>1</td>
      <td>2020</td>
      <td>9</td>
      <td>10</td>
      <td>54790000</td>
      <td>446100</td>
    </tr>
    <tr>
      <th>21145</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>볼보 S90 (휘)</td>
      <td>5</td>
      <td>3.257546</td>
      <td>26</td>
      <td>0</td>
      <td>9</td>
      <td>0.0</td>
      <td>2021-10-30</td>
      <td>1</td>
      <td>2021</td>
      <td>13</td>
      <td>10</td>
      <td>59490000</td>
      <td>446100</td>
    </tr>
    <tr>
      <th>21146</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>BMW 430i 컨버터블(휘)</td>
      <td>4</td>
      <td>3.257546</td>
      <td>26</td>
      <td>3</td>
      <td>24</td>
      <td>4.8</td>
      <td>2021-10-30</td>
      <td>1</td>
      <td>2020</td>
      <td>11</td>
      <td>10</td>
      <td>76500000</td>
      <td>531000</td>
    </tr>
    <tr>
      <th>21147</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>BMW Z4 컨버터블 (휘)</td>
      <td>2</td>
      <td>3.257546</td>
      <td>26</td>
      <td>1</td>
      <td>5</td>
      <td>4.6</td>
      <td>2021-10-30</td>
      <td>1</td>
      <td>2021</td>
      <td>9</td>
      <td>10</td>
      <td>66400000</td>
      <td>531000</td>
    </tr>
    <tr>
      <th>21148</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>A5 카브리올레 TFSI(휘)</td>
      <td>4</td>
      <td>3.257546</td>
      <td>26</td>
      <td>0</td>
      <td>1</td>
      <td>0.0</td>
      <td>2021-10-30</td>
      <td>1</td>
      <td>2021</td>
      <td>12</td>
      <td>10</td>
      <td>75660000</td>
      <td>531000</td>
    </tr>
  </tbody>
</table>
<p>21149 rows × 43 columns</p>
</div>



### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
#### OLS Summary
- (전처리 방법 2 : 라벨 인코딩 + 더미변수화) 보다 0.04가 떨어졌다.
![image.png](attachment:image.png)


### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
#### OLS Summary
- 1.09x10^16 -> 1.26x10^16 : 컨디션 넘버가 조금 커졌지만 이것만 가지고 과적합의 확률이 높아졌다고 말하기 애매하다.

![image.png](attachment:image.png)

### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
### LinearRegression 적용
![image.png](attachment:image.png)
- 라벨 인코딩과 RMSE가 비슷하다.

### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
### LinearRegression 적용
![image.png](attachment:image.png)
- 라벨 인코딩과 RMSE가 비슷하다.

### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
23592
#### RandomRegressor CrossValidation 적용
- 각 등분 별 RMSE
![image.png](attachment:image.png)
- 평균 RMSE : 라벨 인코딩 대비 200원 정도 낮아졌다.
![image-2.png](attachment:image-2.png)


### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
### RandomForest Regressor 적용
![image.png](attachment:image.png)
- 라벨 인코딩보다 RMSE가 100원 올라갔다.

### 전처리 방법 3 : 카테고리 임베딩 + 더미변수화
### RandomForest Regressor 적용
![image.png](attachment:image.png)
- 그래프는 비슷해보인다.

## 결론 : 가격 예측
### 2021-08-06(금) ~ 2021-08-08(일)에 K5을 렌트하고 싶다. 
#### 과연 가격은?!
![image-2.png](attachment:image-2.png)
- 2일 빌리는데 30만원이다..
- 지금부터 알바를 시작해야겠다..
